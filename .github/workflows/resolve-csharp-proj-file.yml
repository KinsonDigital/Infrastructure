name: Resolve CSharp Project File Path


defaults:
  run:
    shell: pwsh
  
  
on:
  workflow_call:
    inputs:
      project-name:
        required: true
        description: "The name of the C# project to validate."
        type: string
      base-path:
        required: false
        description: The base directory path to start the search.
        type: string
    outputs:
      project-file-path:
        description: The resolve csharp project file path.
        value: ${{ jobs.resolve_proj_file_path.outputs.project-file-path }}


jobs:
  resolve_proj_file_path:
    name: Resolve Project File Path
    runs-on: ubuntu-latest
    outputs:
      project-file-path: ${{ steps.resolve-file-path.outputs.project-file-path }}
    steps:
      - name: Print Environment Variables
        run: Get-ChildItem -Path Env:* | Sort-Object Name

      - uses: actions/checkout@v4

      - name: Resolve Project File Path
        id: resolve-file-path
        run: |
          $basePath = "${{ inputs.base-path }}".Trim();
          $basePath = !$basePath -or $basePath -eq "" ? "$env:GITHUB_WORKSPACE" : $basePath;


          if ("${{ inputs.project-name }}" -eq "") {
            Write-Host "::error::The 'project-name' workflow input must not be empty.";
            exit 1;
          }


          $result = Get-ChildItem -Path "$basePath/**/${{ inputs.project-name }}.csproj" -Recurse | ForEach-Object{$_.FullName};

          $resultType = $result ? $result.GetType().Name : $null;

          # If null, no project file was found
          if (!$result) {
            Write-Host "::error::Project file not found";
            exit 1;
          } elseif ($resultType -ne "String") {
            Write-Host "::error::Found too many project files!!";

            foreach ($item in $result) {
                Write-Host "`t$item";
            }

            exit 1;
          } else {
            Write-Host "::notice::Project File Path Resolved To: $result";
            "project-file-path=$result" >> $env:GITHUB_OUTPUT;
          }
